#!/usr/bin/env bash

set -e
export WORKDIR=$(cd $(dirname $0) && pwd)
if [ ! -f "$WORKDIR/config" ]; then
    cp $WORKDIR/config.template $WORKDIR/config
fi
export CONFIG=$WORKDIR/config

. $WORKDIR/common

# options and values
export aFlag=0 #asgn flag
export pFlag=0 #path flag
export fFlag=0 #force flag

export aVal=0 #id
export pVal=0 #path

Usage() {
    echo $'Usage: \n\nCommands: \n'
}
Help() {
    echo $'Cloodle (Moodle CLI)\nGitHub: \nVersion:' $(cat $WORKDIR/VERSION) $'\n'
    Usage
}

# https://stackoverflow.com/a/5230306
if ! options=$(getopt -u -o fp:a: -l force,path:,asgn: -- "$@"); then
    exit 1
fi

set -- $options

while [ $# -gt 0 ]; do
    
    # echo "in loop $0 $1 $2"
    case $1 in
        -a|--asgn)
            aFlag=1
            aVal=$2
            shift
            ;;
        -p|--path)
            pFlag=1
            pVal=$2
            shift
            ;;
        -f|--force)
            fFlag=1
            ;;
        (--)
            shift
            break
            ;;
        (-*)
            echo "$0: error - unrecognized option $1" 1>&2; 
            Usage
            exit 1
            ;;
        (*)
            Usage
            break;;
    esac
    shift
done

case "$1" in
    help)
        Help
        exit 0
        ;;
    login)
        . $WORKDIR/commands/Login
        Login
        exit 0
        ;;
    display)
        . $WORKDIR/commands/Display
        Display
        exit 0
        ;;
    upload)
        . $WORKDIR/commands/Upload
        Upload
        exit 0
        ;;
    *)
        echo "$0: error - unrecognized command $1" 1>&2;
        Usage
        exit 1
        ;;
esac
